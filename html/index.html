<!DOCTYPE html> 
<!--- BaboRace - Desenvolvido por Victor Pellegrini Mammana - 2021_10_16 --->
<html lang="en">
<meta charset="ISO-8859-1">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />

	<head>
		<title>
		Entendendo a relatividade
		</title>
	</head>
<style>

img {
	display: block;
}

table {
	padding: 0px;
	border-spacing: 0px;
	border-collapse: collapse;
}

tr,td {
}

input[type="button"] {
	font-size: 1em;
	line-height: 1em;
	padding: 1px;
	background-color: red;
	color: black;
}

input[type="text"]{
    font-size: 1em;
    line-height: 1em;
    display: inline-block;
    padding: 0px;
    border: none;
}

body{
  background-color: blue;
  background: -moz-radial-gradient(center, ellipse cover, #0047ea 0%, #151515 100%);
  background: radial-gradient(#0047ea, #151515);
  height: 100vh;
  overflow: hidden;
}

#comandos {
	position: absolute;
	top: 0px;
	left: 0px;
	width: 100%;
	height: 6%;
	padding: 0px;
	border: 1px solid white;	
	box-sizing: border-box;
	z-index: 100;
	background-color: blue;
	overflow: scroll;
}


#nao_opaco { 
	width: 21%;
	height:94%;
	position: absolute;
	top: 6%;
	left: 79%;
	z-index: 200;
	overflow: hidden;
	opacity: 0.3;
	background-color: gray;
}


#contem {
	width: 21%;
	height:94%;
	position: absolute;
	top: 6%;
	left: 79%;
	z-index: 1000;
	overflow: hidden;
	opacity: 0.9;
	background-color: none;
}

#principal {
	position: absolute;
	top: 7%;
	left: 0px;
	width: 3000px;
	height: 3000px;
	padding: 0px;
	border: 1px solid red;	
	box-sizing: border-box;
}

	#programa {
		width: 100%;
		height: 100%;
		position: absolute;
		border: 1px solid black;
		overflow: scroll;
		scroll-behavior: smooth;
	}
</style>

<body>
<div id="nao_opaco"></div>
<div id="contem">
<div id="programa">
</div>
</div>
<div id="comandos">
<!---<table width="10%" cellspacing="0">--->
<!---	<tr>--->
<!---		<td><input type="button" value="Gira Móvel" onclick="window.controle.selecionado.gira(document.getElementById('delta_graus').value,document.getElementById('passos').value);"></td>--->
<!---		<td><input id="delta_graus" size="4" type="text"  placeholder="delta_graus"></td>--->
<!---		<td><input id="passos" type="text" size="4" placeholder="passos"></td>--->
<!---		<td width="30px"></td>--->
<!---		<td width="100px"></td>--->
<!---		<td><input type="button" value="Impulso X" onclick="window.controle.selecionado.Fx = document.getElementById('impulso_X').value;"></td>--->
<!---		<td><input id="impulso_X" type="text" size="4" placeholder="impulso_X"></td>--->
<!---		<td><input type="button" value="Para o Giro" onclick="window.controle.selecionado.para_giro();"></td><td></td><td></td>--->
<!---		<td><input type="button" value="Ação" onclick="acao();"></td><td></td><td></td>--->
<!---	</tr>--->
<!---	<tr>--->
<!---		<td><input type="button" value="Deslizar" onclick="window.controle.selecionado.desliza( document.getElementById('x_percentual').value, document.getElementById('y_percentual').value, document.getElementById('passos_posicao').value);"></td>--->
<!---		<td><input id="x_percentual" size="4" type="text" placeholder="x_%"></td>--->
<!---		<td><input id="y_percentual" type="text" size="4" placeholder="y_%"></td>--->
<!---		<td><input id="passos_posicao" type="text" size="4" placeholder="passos"></td>--->
<!---		<td width="100px"></td>--->
<!---		<td><input type="button" value="Impulso Y" onclick="window.controle.selecionado.Fy = document.getElementById('impulso_Y').value;"></td>--->
<!---		<td><input id="impulso_Y" type="text" size="4" placeholder="impulso_Y"></td>--->
<!---	<td><input type="button" value="Para Deslizamento" onclick="window.controle.selecionado.para_desliza();"></td><td></td><td></td>--->
<!------>
<!---	</tr>--->
<!---</table>--->

<input id="botao_repeticao" type="button" value="REPETE" onclick="window.insere_bloco(document.getElementById('programa').style.ponto_de_insercao.elemento_pai, 'repeticao'); ">
<input id="botao_desvio" type="button" value="SE" onclick="window.insere_bloco(document.getElementById('programa').style.ponto_de_insercao.elemento_pai, 'desvio'); ">
<input id="botao_desvio" type="button" value="Fx" onclick="window.insere_bloco(document.getElementById('programa').style.ponto_de_insercao.elemento_pai, 'Fx'); ">
<input id="botao_desvio" type="button" value="Fy" onclick="window.insere_bloco(document.getElementById('programa').style.ponto_de_insercao.elemento_pai, 'Fy'); ">
<input id="botao_desvio" type="button" value="ESPERA" onclick="window.insere_bloco(document.getElementById('programa').style.ponto_de_insercao.elemento_pai, 'delay'); ">
<input id="botao_va_para_x" type="button" value="Va para X" onclick="window.insere_bloco(document.getElementById('programa').style.ponto_de_insercao.elemento_pai, 'va_para_x'); ">
<input id="botao_desvio" type="button" value="Va para Y" onclick="window.insere_bloco(document.getElementById('programa').style.ponto_de_insercao.elemento_pai, 'va_para_y'); ">
Os botoes acima permitem inserir comandos no codigo aa direita. Com as setas voce pode mudar o ponto de insercao. Com o delete voce pode apagar um comando. Quando estiver com o ponto de insercao num determnado local, o comando abaixo comecara a piscar, indicando que vc pode entrar nele com a seta para a direta.
O Espaco dispara o codigo.
</div>

<div id="principal">


</div>
<script>

function limpa_todos_blink(config){
let i;

let lista = document.getElementsByClassName(config.classe_div);
for (i=0; i < lista.length; i++) {
	lista[i].style.pai.fim_blink();
	
} 

}



function swap(lista, indice_origem, indice_destino){

let troca = lista[indice_origem];
lista[indice_origem] = lista[indice_destino];
lista[indice_destino] = troca;

}

function isCharNumber(c) {
  return c >= '0' && c <= '9';
}

document.addEventListener("keydown",
function (e){

console.log(e.key);
if (e.target.className == "entrada") {

	if (!(e.key == "ArrowUp" || e.key == "ArrowDown")) {return;}
}

let pai =  programa.style.ponto_de_insercao.elemento_pai;

if (e.key = " " ) {window.bloco1.monta_executavel(programa.style.principal);}

if (e.key == "Delete") {
	if (pai.indice_ponto_de_blinking <= pai.instrucoes.length - 1 && pai.indice_ponto_de_blinking >0)
	{
		let removed3 = pai.instrucoes.splice(pai.indice_ponto_de_blinking,1);
		removed3[0].face.remove();
		removed3[0]={};
		removed3=[];
		document.getElementById('programa').style.principal.innerHTML=''; 
		document.getElementById('programa').style.principal.mostra();
		limpa_todos_blink(window.config);
		return;
	
	} 

}		


if (e.key == "ArrowUp") { if (pai.indice_ponto_de_insercao>0) { swap(pai.instrucoes,pai.indice_ponto_de_insercao, pai.indice_ponto_de_insercao - 1);  pai.indice_ponto_de_insercao--; } }
if (e.key == "ArrowDown") { if (pai.indice_ponto_de_insercao< pai.instrucoes.length - 1) { swap(pai.instrucoes,pai.indice_ponto_de_insercao, pai.indice_ponto_de_insercao + 1);  pai.indice_ponto_de_insercao++; } }
if (e.key == "ArrowRight") { if (pai.indice_ponto_de_blinking <= pai.instrucoes.length - 1 && pai.indice_ponto_de_blinking >0) 
				{ 
				if (["desvio", "principal", "repeticao"].includes(pai.instrucoes[pai.indice_ponto_de_blinking].tipo) ) {
					programa.style.ponto_de_insercao = pai.instrucoes[pai.indice_ponto_de_blinking].ativa_ponto_de_insercao(0); // coloca no comeco
					var removed2 = pai.instrucoes.splice(pai.indice_ponto_de_insercao,1); 
								console.log("direita");
								console.log(removed2[0]);
								removed2[0].face.remove();
								removed2[0]={};
								removed2=[];
								document.getElementById('programa').style.principal.innerHTML=''; 
								document.getElementById('programa').style.principal.mostra();
								limpa_todos_blink(window.config);
								return;

				}
				} 
			}

if (e.key == "ArrowLeft") { 
	if ( pai.elemento_pai != document.getElementById("programa")) {
		let removed = pai.instrucoes.splice(pai.indice_ponto_de_insercao,1);  
		pai.indice_ponto_de_insercao=-1;
		let guarda = pai.elemento_pai.indice_ponto_de_insercao;
		//alert(guarda);
		programa.style.ponto_de_insercao = pai.elemento_pai.ativa_ponto_de_insercao(guarda);
		programa.style.ponto_de_insercao.elemento_pai.indice_ponto_de_insercao = guarda;
		console.log("esquerda");
		console.log(removed);
		removed[0].face.remove();
		removed[0]={};
		removed=[];
		limpa_todos_blink(window.config);	
		document.getElementById('programa').style.principal.innerHTML=''; 
		document.getElementById('programa').style.principal.mostra();
		return;
	}
}

pai.indice_ponto_de_blinking = pai.indice_ponto_de_insercao + 1;

limpa_todos_blink(window.config);
if (pai.indice_ponto_de_blinking <= pai.instrucoes.length - 1) { 
		if (["desvio", "principal", "repeticao"].includes(pai.instrucoes[pai.indice_ponto_de_blinking].tipo) ) {
				pai.instrucoes[pai.indice_ponto_de_blinking].inicia_blink();
		}
}

document.getElementById('programa').style.principal.innerHTML=''; 
document.getElementById('programa').style.principal.mostra();
console.log(contem.clientHeight + " - " + programa.style.ponto_de_insercao.face.style.top.replace("px","") );
if ( parseInt(programa.style.ponto_de_insercao.face.style.top.replace("px","")) > parseInt(contem.clientHeight) ||
	parseInt(programa.style.ponto_de_insercao.face.style.height.replace("px","")) < programa.scrollTop)
{

	programa.scrollTop=parseInt(programa.style.ponto_de_insercao.face.style.top.replace("px",""));
}

}, true
)

function acao(){


window.movel1.desliza(0.1,0,300); 

window.movel2.desliza(-0.1,0,295); 

//window.movel1.gira(1,2000)

}

document.getElementById("principal").addEventListener("focusout", function (e) {alert(e.activeElement);});

</script>

<script type="module">
	import { movel } from "./objetos.js";
	import { controle_geral } from "./objetos.js";
	import { configuracoes } from "./mod_bloco.js";
	import { bloco } from "./mod_bloco.js";

function insere_bloco(objeto, tipo){

let objeto_itz = new bloco(window.config, null, null, objeto.esquerda, objeto.topo, tipo, objeto.guarda_altura, objeto.guarda_largura, objeto);
objeto.insere_instrucao(objeto_itz);


document.getElementById('programa').style.principal.innerHTML=''; document.getElementById('programa').style.principal.mostra();
}

window.insere_bloco = insere_bloco;

window.addEventListener("load", 
function () {

window.controle = new controle_geral(document.getElementById("principal"));
window.controle.espacamento_superior = document.getElementById("comandos").clientHeight;
window.controle.palco.carrega_json_cenario();
   
setTimeout(function (){
   window.movel1 = new movel("amarelo", "../fantasias/carrinho_amarelo1.png", "fantasia1", window.controle, "movel", "img","falta_algoritmo_para_sofre_colisao");
}, 1000);

setTimeout(function (){
        window.movel2 = new movel("vermelho", "../fantasias/carrinho_vermelho1.png", "fantasia1", window.controle, "movel", "img","fata_algoritmo_para_sofre_colisao");
}, 1500);


setTimeout(function (){
	
	window.movel1.largura_percentual=3;
	window.movel1.altura_percentual=3;

	window.movel1.acrescenta_fantasia("../fantasias/carrinho_amarelo2.png", "fantasia2");
	window.movel1.acrescenta_fantasia("../fantasias/carrinho_amarelo3.png", "fantasia3");
	window.movel1.acrescenta_fantasia("../fantasias/carrinho_amarelo4.png", "fantasia4");
	//window.movel1.acrescenta_fantasia("../fantasias/carrinho_vermelho1.png", "fantasia4");
    console.log(window.movel1)
	window.movel1.posicao_percentual_x=10;
	window.movel1.posicao_percentual_y=90;

	window.movel2.largura_percentual=3;
	window.movel2.altura_percentual=3;
	//window.movel1.acrescenta_em_detecao(window.movel2);
	window.movel2.posicao_percentual_x=20;
	window.movel2.posicao_percentual_y=90;



	
	},2000);

setTimeout(function (){
	//alert(window.movel1.estado_prop);
	if (window.movel1.estado_prop == "falhou"){
	alert("Não foi possível carregar o arquivo: "+window.movel1.fantasia.src);
	throw new Error ('Não foi possível ler o arquivo de imagem');
	}
	window.controle.selecionado = window.movel1;
	window.controle.central = window.movel1;

	window.controle.inicia_animacao();


var contem =  document.getElementById("contem");
var programa = document.getElementById("programa");

programa.style.width = contem.getBoundingClientRect().width + "px";
programa.style.height = contem.getBoundingClientRect().height + "px";
//programa.style.height = "600px";
//alert(contem.getBoundingClientRect().width);
//contem.style.width = programa.offsetWidth + "px";
//contem.style.height = programa.offsetHeight; 
window.config = new configuracoes(programa);
window.bloco1 = new bloco(config, null, null, config.esquerda, config.topo, "principal", config.altura, config.largura, config.elemento_pai);
window.config.movel = window.movel1;
programa.style.principal = bloco1;
programa.style.ponto_de_insercao =  bloco1.ativa_ponto_de_insercao(0);
bloco1.mostra();





	},2500);
});
						//window.movel1.posiciona_percentual(50,50);
    </script>
</body>
</html>

